<div class="calendar-container">
    <!-- Header avec navigation -->
    <div class="calendar-header">
      <div class="month-navigation">
        <button mat-icon-button (click)="previousMonth()">
          <mat-icon>chevron_left</mat-icon>
        </button>
  
        <h2 class="current-month">{{ getMonthName(currentMonth) }} {{ currentYear }}</h2>
  
        <button mat-icon-button (click)="nextMonth()">
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
  
      <div class="calendar-actions">
        <button mat-icon-button [matMenuTriggerFor]="filterMenu">
          <mat-icon>filter_list</mat-icon>
        </button>
  
        <button mat-raised-button color="primary" (click)="goToToday()">
          Aujourd'hui
        </button>
      </div>
    </div>
  
    <!-- Menu de filtres -->
    <mat-menu #filterMenu="matMenu" class="filter-menu">
      <div class="filter-options" (click)="$event.stopPropagation()">
        <mat-checkbox
          [(ngModel)]="showProjects"
          (change)="updateFilters()"
          color="primary">
          Projets
        </mat-checkbox>
  
        <mat-checkbox
          [(ngModel)]="showLeaves"
          (change)="updateFilters()"
          color="primary">
          Congés
        </mat-checkbox>
  
        <mat-checkbox
          [(ngModel)]="showAttendance"
          (change)="updateFilters()"
          color="primary">
          Pointages
        </mat-checkbox>
  
        <mat-checkbox
          [(ngModel)]="showMeetings"
          (change)="updateFilters()"
          color="primary">
          Réunions
        </mat-checkbox>
      </div>
    </mat-menu>
  
    <!-- Légende -->
    <div class="calendar-legend">
      <div class="legend-item" *ngIf="showProjects">
        <div class="legend-color" style="background-color: #1976d2"></div>
        <span>Projets</span>
      </div>
      <div class="legend-item" *ngIf="showLeaves">
        <div class="legend-color" style="background-color: #4caf50"></div>
        <span>Congés</span>
      </div>
      <div class="legend-item" *ngIf="showAttendance">
        <div class="legend-color" style="background-color: #ff9800"></div>
        <span>Pointages</span>
      </div>
      <div class="legend-item" *ngIf="showMeetings">
        <div class="legend-color" style="background-color: #9c27b0"></div>
        <span>Réunions</span>
      </div>
    </div>
  
    <!-- Grille du calendrier -->
    <div class="calendar-grid">
      <!-- Jours de la semaine -->
      <div class="weekdays-header">
        <div class="weekday" *ngFor="let day of weekdays">{{ day }}</div>
      </div>
  
      <!-- Semaines -->
      <div class="weeks-container">
        <div class="week" *ngFor="let week of calendarMonth?.weeks">
          <div
            class="day-cell"
            *ngFor="let day of week.days"
            [class.current-month]="day.isCurrentMonth"
            [class.today]="day.isToday"
            [class.weekend]="day.isWeekend"
            [class.has-events]="day.events.length > 0">
  
            <!-- Numéro du jour -->
            <div class="day-number">{{ day.dayNumber }}</div>
  
            <!-- Événements du jour -->
            <div class="day-events">
              <div
                class="event-item"
                *ngFor="let event of day.events.slice(0, 3)"
                [style.background-color]="event.color"
                (click)="openEventDetails(event)"
                matTooltip="{{ event.title }} - {{ getEventTypeLabel(event.type) }}">
                <span class="event-title">{{ event.title }}</span>
              </div>
  
              <!-- Indicateur si plus d'événements -->
              <div class="more-events" *ngIf="day.events.length > 3">
                +{{ day.events.length - 3 }} autres
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Statistiques du mois -->
    <div class="month-stats" *ngIf="!isMobile">
      <mat-card class="stats-card">
        <mat-card-header>
          <mat-card-title>Aperçu du mois</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stats-grid">
            <div class="stat-item" *ngIf="showProjects">
              <div class="stat-number">{{ getEventCount('project') }}</div>
              <div class="stat-label">Projets actifs</div>
            </div>
            <div class="stat-item" *ngIf="showLeaves">
              <div class="stat-number">{{ getEventCount('leave') }}</div>
              <div class="stat-label">Jours de congé</div>
            </div>
            <div class="stat-item" *ngIf="showAttendance">
              <div class="stat-number">{{ getEventCount('attendance') }}</div>
              <div class="stat-label">Journées travaillées</div>
            </div>
            <div class="stat-item">
              <div class="stat-number">{{ getTotalEvents() }}</div>
              <div class="stat-label">Événements total</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>